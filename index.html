<html><head>
    <style text="text/css">
    html, body {
        padding: 0; margin: 0;
    }

    #window {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    #largecanv {
      width: 2000px;
        height: 2000px;
        position: absolute;
        top: 0px;
        left: 0px;
        transition: all 125ms linear 0s;
    
}
    </style>

    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    </head>
    <body>
	    
      <div id="window">
        <div id="gas"></div>
        <canvas id="largecanv" width="2000" height="2000" style="transform: translateX(1x); top: 1px; left: 1px;"></canvas>
        <canvas id="littlcanv" width="200" height="200"></canvas>
      </div>
    

	<script>
	//	window.onload = function(){
        let bcanv = document.getElementById('largecanv');
        let lcanv = document.getElementById('littlcanv');
        let camer = document.getElementById('layer2');
        let ctx   = bcanv.getContext('2d', { alpha: false });
        let dtx   = lcanv.getContext('2d', { alpha: false });
        document.getElementById('littlcanv').remove();
        //Убираем размытие
        ctx.mozImageSmoothingEnabled = false;ctx.webkitImageSmoothingEnabled = false;ctx.msImageSmoothingEnabled = false;ctx.imageSmoothingEnabled = false;dtx.mozImageSmoothingEnabled = false;dtx.webkitImageSmoothingEnabled = false;dtx.msImageSmoothingEnabled = false;dtx.imageSmoothingEnabled = false;
        //
        //Определение телефон ли это
        var iphone = 0;
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)) {

          iphone = 1;

        } 
        //
        var x = 0, y =0; let pixlb = [];
        wallOfPixelsGen();
        function wallOfPixelsGen(){
          for (var i = 0; i<=40000; i++) {
            if (i == ((y+1)/1)*200) {y = y + 1; x = 0;}

            pixlb.push({
	          	'x': x,
	          	'y': y,	    	
              'r': 50,
              'g': 130,
              'b': 184,
              'id': i+1,
	          });

		        dtx.fillStyle = "rgb("+randomInteger(60, 70)+","+randomInteger(80, 200)+","+randomInteger(100, 110)+")";
            dtx.fillRect(pixlb[i].x, pixlb[i].y, 1, 1);
            x = x + 1;
            };
            ctx.drawImage(lcanv, 0, 0, 2000, 2000);
        }
        //Навигация по большому канвасу (PC)
        var capture = false, cx = 0, cy = 0,canidraw=0;
        var sz=1,sxx=1,syy=1;
        if(iphone!=1){
      
        bcanv.addEventListener('mouseup', function () {
	        capture = false;
	        bcanv.style.cursor = 'default';
          if(canidraw == true){draw(cx,cy,event.clientX,event.clientY); }
          canidraw = true;
        }, false);

        bcanv.addEventListener('mousedown', function (event) {
          capture = true;
	            x = event.clientX;
	            y = event.clientY;
              
        }, false);

        bcanv.addEventListener('mousemove', function (event) {
          
	        if (capture) {
            if (false !=canidraw) {canidraw = false};
		        cx -= x - event.clientX, cy -= y - event.clientY;
           
            bcanv.style = "top: "+cy+"px; left: "+cx+"px;" + " width: "+scale+"px; height:"+scale+"px;";
            x = event.clientX;
		        y = event.clientY;	
	        }
        }, false);
        }
        //Навигация по большому канвасу (PHONE)
        var captureP = false, cxP = 0, cyP = 0,canidrawP=0;
        let levent;
        bcanv.addEventListener("touchend", function (event) {
	        captureP = false;
          if(canidrawP == true){draw(cxP,cyP,levent.touches[0].clientX,levent.touches[0].clientY);};
          canidrawP = true;
          scaling = false;
        }, false);
        //////
         function distance (p1, p2) {
          return (Math.sqrt(Math.pow((p1.clientX - p2.clientX), 2) + Math.pow((p1.clientY - p2.clientY), 2)));
         
         }
        //////
        bcanv.addEventListener("touchstart", function (event) {
          levent = event;
          captureP = true;
	            x = event.touches[0].clientX;
              y = event.touches[0].clientY;
             
        //
                  if (event.targetTouches.length >= 2) {
                  dist = Math.trunc(distance(event.targetTouches[0], event.targetTouches[1]));
                  scaling = true;
                 
                } else {
                  scaling = false;
                }
        //
           
        }, false);
        var randscale=0;
        bcanv.addEventListener("touchmove", function (event) {
          
	        if (captureP) {
            if (false !=canidrawP) {canidrawP = false};
		        
            //cxP = cxP-20;cyP = cyP - 20;
            
           //    
            if (scaling) {
                
                 curr_scale = Math.trunc((distance(event.targetTouches[0], event.targetTouches[1])- dist)/10) ;
                 if(randscale != curr_scale && randscale != curr_scale+1 && randscale != curr_scale-1 && curr_scale !=0){
                 if(curr_scale > 0 && scale < 2500){
                  canidrawP = false;
                  scale = scale + 60;
                  perspc = ((scale)/2)/100;
                  cyP = cyP - 30;
                  cxP = cxP - 30;
                  bcanv.style = "top: "+cyP+"px; left: "+cxP+"px;" + " width: "+scale+"px; height:"+scale+"px;";
                  dist = Math.trunc(distance(event.targetTouches[0], event.targetTouches[1]));
                 }else if(scale != 500){
                  canidrawP = false;
                  scale = scale - 60;
                   perspc = ((scale)/2)/100;
                  cyP = cyP + 30;
                  cxP = cxP + 30;  
                  bcanv.style = "top: "+cyP+"px; left: "+cxP+"px;" + " width: "+scale+"px; height:"+scale+"px;";
                  dist = Math.trunc(distance(event.targetTouches[0], event.targetTouches[1]));
                 }randscale = curr_scale;}
                 document.getElementById("gas").innerText = curr_scale;  
            }else{cxP -= x - event.touches[0].clientX, cyP -= y - event.touches[0].clientY;
              bcanv.style = "top: "+cyP+"px; left: "+cxP+"px;" + " width: "+scale+"px; height:"+scale+"px;";}
         //
            x = event.touches[0].clientX;
		        y = event.touches[0].clientY;	
            
	        }
        }, false);



        //

        let path1 = new Path2D();
        let perspc = 10;
        function draw(cx,cy,evx,evy){
          var dx, dy, idd;
          dx = evx - cx;
          dy = evy - cy;
          
          
          console.log(perspc);
          dx = Math.trunc(dx / perspc);
          dy = Math.trunc(dy / perspc);

          idd = dx + dy * 200;
          var o = pixlb[idd];
          dtx.fillStyle = "red";
          path1.rect(o.x , o.y, 1, 1);
          dtx.fill(path1);
          ctx.drawImage(lcanv, 0, 0, 2000, 2000);
        };

        //Увеличение колесиком мыши
        
        function addOnWheel(elem, handler) {
          if (elem.addEventListener) {
            if ('onwheel' in document) {
              elem.addEventListener("wheel", handler);
            } else if ('onmousewheel' in document) {
              elem.addEventListener("mousewheel", handler);
            } else {
              elem.addEventListener("MozMousePixelScroll", handler);
            }
          } else {
            text.attachEvent("onmousewheel", handler);
          }
        }
        var scale = 2000; var tsx,tsy,deltel = 50;
        addOnWheel(bcanv, function(e) {
          dx = event.clientX - cx;
          dy = event.clientY - cy;
          dx = Math.trunc(dx);
          dy = Math.trunc(dy);
          var delta = e.deltaY || e.detail || e.wheelDelta;
          
          if (delta > 0){
            if (scale < 2500){
            scale = scale + 60;
            perspc = ((scale)/2)/100;
            cy = cy - 30;
            cx = cx - 30;
            bcanv.style = "top: "+cy+"px; left: "+cx+"px;" + " width: "+scale+"px; height:"+scale+"px;";
            console.log(cy)
            }
          }
          else if(scale != 500) {
            scale = scale - 60;
            perspc = ((scale)/2)/100;
            cy = cy + 30;
            cx = cx + 30;  
            bcanv.style = "top: "+cy+"px; left: "+cx+"px;" + " width: "+scale+"px; height:"+scale+"px;";
            console.log(cy);
          };
          e.preventDefault();
        });
        //
        // Зум телефон 
        /*Определяем некоторые переменные*/
        var objzoom = bcanv;
        var scaling = false;
        var dist = 0;
        var scale_factor = 1.0;
        var curr_scale = 1.0;
        var max_zoom = 8.0;
        var min_zoom = 0.5
//         /*Пишем функцию, которая определяет расстояние меж пальцами*/
//         function distance (p1, p2) {
//          return (Math.sqrt(Math.pow((p1.clientX - p2.clientX), 2) + Math.pow((p1.clientY - p2.clientY), 2)));
         
//         }
//         /*Ловим начало косания*/
//         objzoom.addEventListener('touchstart', function(evt) {
//           evt.preventDefault();
//           var tt = evt.targetTouches;
//           if (tt.length >= 2) {
//           dist = distance(tt[0], tt[1]);
//           scaling = true;
//         } else {
//           scaling = false;
//         }
//         }, false);
//         /*Ловим зумирование*/
//         objzoom.addEventListener('touchmove', function(evt) {
//         evt.preventDefault();
//         var tt = evt.targetTouches;
//         if (scaling) {
          
//           curr_scale = distance(tt[0], tt[1]) / dist * scale_factor;
//           objzoom.style.WebkitTransform = "scale(" + curr_scale + ", " + curr_scale + ")";
//           document.getElementById("gas").innerText = curr_scale;
//         }
//         }, false);
//         /*Ловим конец косания*/
//         objzoom.addEventListener('touchend', function(evt) {
//         var tt = evt.targetTouches;
//         if (tt.length < 2) {
//          scaling = false;
//         if (curr_scale < min_zoom) {
//           scale_factor = min_zoom;
//         } else {
//         if (curr_scale > max_zoom) {
//          scale_factor = max_zoom;
//         } else {
//          scale_factor = curr_scale;
//         }
//         }
//          objzoom.style.WebkitTransform = "scale(" + scale_factor + ", " + scale_factor + ")";
//         } else {
//          scaling = true;
//         }
//         }, false);
// //
    //}
        function randomInteger(min, max) {
  // случайное число от min до (max+1)
           let rand = min + Math.random() * (max + 1 - min);
          return Math.floor(rand);
        }

      </script>
    

</body></html>