<html><head>
    <style text="text/css">
    html, body {
        padding: 0; margin: 0;
    }

    #window {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    #largecanv {
    position: absolute;
    
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
}
    </style>

    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    </head>
    <body>
	<div id="windowc">    
    <div id="window">
      <div class="layer2">
        <canvas id="largecanv" width="1000" height="550"></canvas>
        <canvas id="littlcanv" width="200" height="200"></canvas>
      </div>
    </div>
	</div>
	<script>
	//	window.onload = function(){
        let bcanv = document.getElementById('largecanv');
        let lcanv = document.getElementById('littlcanv');
        let ctx   = bcanv.getContext('2d', { alpha: false });
        let dtx   = lcanv.getContext('2d', { alpha: false });
        //Убираем размытие
        ctx.mozImageSmoothingEnabled = false;ctx.webkitImageSmoothingEnabled = false;ctx.msImageSmoothingEnabled = false;ctx.imageSmoothingEnabled = false;dtx.mozImageSmoothingEnabled = false;dtx.webkitImageSmoothingEnabled = false;dtx.msImageSmoothingEnabled = false;dtx.imageSmoothingEnabled = false;
        //
        var x = 0, y =0; let pixlb = [];
        wallOfPixelsGen()
        function wallOfPixelsGen(){
          for (var i = 0; i<=40000; i++) {
            if (i == ((y+1)/1)*200) {y = y + 1; x = 0;}

            pixlb.push({
	          	'x': x,
	          	'y': y,	    	
              'r': 50,
              'g': 130,
              'b': 184,
              'id': i+1,
	          });

		        dtx.fillStyle = "rgb("+randomInteger(1, 110)+","+randomInteger(1, 110)+","+randomInteger(100, 110)+")";
            dtx.fillRect(pixlb[i].x, pixlb[i].y, 1, 1);
            x = x + 1;
            };
            ctx.drawImage(lcanv, 0, 0, 2000, 2000);
        }
        //Навигация по большому канвасу (ПК)
        var capture = false, cx = 0, cy = 0,canidraw=0;

        bcanv.addEventListener('mouseup', function () {
	        capture = false;
	        bcanv.style.cursor = 'default';
          if(canidraw == true){draw(); console.log("Пытаюсь рисовать..")}
          canidraw = true;
        }, false);

        bcanv.addEventListener('mousedown', function (event) {
	        //capture = true;
	    
          bcanv.style.cursor = 'grab';
        }, false)

        bcanv.addEventListener('mousemove', function (event) {
          if (capture) {
            if (canidraw != false) {canidraw = false};
            cx = cx - (x - event.clientX), cy = cy - (y - event.clientY);	
          }
          x = event.clientX;
          y = event.clientY;
        }, false);

        //

        let path1 = new Path2D();
        function draw(){
          var dx, dy, idd;
          dx = event.clientX - cx;
          dy = event.clientY - cy;
          dx = Math.trunc(dx / 10);
          dy = Math.trunc(dy / 10);
          idd = dx + dy * 200;
          var o = pixlb[idd];
          dtx.fillStyle = "red";
          path1.rect(o.x , o.y, 1, 1);
          dtx.fill(path1);
          ctx.drawImage(lcanv, 0, 0, 4000, 4000);
        }

        //Увеличение колесиком мыши
        
        function addOnWheel(elem, handler) {
          if (elem.addEventListener) {
            if ('onwheel' in document) {
              elem.addEventListener("wheel", handler);
            } else if ('onmousewheel' in document) {
              elem.addEventListener("mousewheel", handler);
            } else {
              elem.addEventListener("MozMousePixelScroll", handler);
            }
          } else {
            text.attachEvent("onmousewheel", handler);
          }
        }
        var scale = 1; var tsx,tsy;
        addOnWheel(bcanv, function(e) {
          dx = event.clientX - cx;
          dy = event.clientY - cy;
          dx = Math.trunc(dx);
          dy = Math.trunc(dy);
          var delta = e.deltaY || e.detail || e.wheelDelta;
          var cursx = dx 
          if (delta > 0 && scale < 1.92) {
            ctx.clearRect(0, 0, bcanv.width, bcanv.height);
            //dx = dx-250/scale;
            //dy = dy-250/scale;
            dx = Math.trunc(dx);
          dy = Math.trunc(dy);
            tsx = 500/scale;
            tsy = 500/scale;
            ctx.drawImage(lcanv, dx, dy, tsx, tsy);
            scale = scale * 2;
            console.log(scale+" "+dx+" "+dy)
          }
          else if(scale != 0.12 && delta <0) {
            ctx.clearRect(0, 0, bcanv.width, bcanv.height);
            //dx = dx - tsx;
            //dy = dy - tsy;
            dx = Math.trunc(dx);
          dy = Math.trunc(dy);
            ctx.drawImage(lcanv, dx, dy, tsx*2, tsy*2);
            tsx = tsx *2
            tsy = tsy *2
            scale = scale *100;
            scale = Math.floor(scale/2)
            scale = scale /100;
            console.log(scale+" "+dx+" "+dy)
           };
          e.preventDefault();
        });
    //}
        function randomInteger(min, max) {
  // случайное число от min до (max+1)
           let rand = min + Math.random() * (max + 1 - min);
          return Math.floor(rand);
        }

      </script>
    

</body></html>