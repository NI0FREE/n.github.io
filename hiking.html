<!DOCTYPE html>
<html lang="en">
    <head>
        <style text="text/css">
            * { margin:0; padding:0; }
            html, body { width:100%; height:100%; }
            canvas { display:block; }
            
              .onlineform{
                top: calc(var(--safe-area-inset-top) + 10px);
                top: 9px;
                padding: 9px 12px;
                padding-top: 9px;
                padding-right: 12px;
                padding-bottom: 9px;
                padding-left: 12px;
                line-height: 18px;
                background-color: rgba(40,43,46,.2);
                border-radius: 7px;
                border-top-left-radius: 7px;
                border-top-right-radius: 7px;
                border-bottom-right-radius: 7px;
                border-bottom-left-radius: 7px;
                position: fixed;
                z-index: 10;
                background-color: rgba(40,43,46,.2);
                color: #fff;
                font-size: 14px;
                line-height: 19px;
                font-weight: 500;
                padding: 10px 12px 7px;
                border-radius: 10px;
                left: 8px;
                font-family: var(--font-android);
                font-family: Roboto,Arial;
            }
        </style>
    </head>
<body>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>

    <script>
        let myinfo = 0;
     vkBridge.send('VKWebAppInit');
    vkBridge.send("VKWebAppGetUserInfo").then(result => {
        myinfo = result;})
    </script> 
    <script src="file:///C:/Users/vasin/Desktop/helloworld/fabric.min%20(1).js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<div class="intro">
<div style="position: absolute;">
    <div id="online" class="onlineform" style="position: relative;float: left;">Online: 0</div>
    <div id="online" class="onlineform" style="position: relative;float: left;padding: 8px 10px 4px;margin-left: 2px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" width="19px" height="19px" viewBox="0 0 500 500" style="    fill: white; enable-background:new 0 0 507.451 507.45;" xml:space="preserve">
<g>
	<g id="settings">
		<path d="M440.813,280.5c0-7.65,2.55-15.3,2.55-25.5s0-17.85-2.55-25.5l53.55-43.35c5.1-5.1,5.1-10.2,2.55-15.3l-51-89.25    c-2.55-2.55-7.649-5.1-15.3-2.55l-63.75,25.5c-12.75-10.2-28.05-17.85-43.35-25.5l-10.2-66.3C315.863,5.1,308.212,0,303.113,0    h-102c-5.101,0-12.75,5.1-12.75,10.2l-10.2,68.85c-15.3,5.1-28.05,15.3-43.35,25.5l-61.2-25.5c-7.65-2.55-12.75,0-17.851,5.1    l-51,89.25c-2.55,2.55,0,10.2,5.1,15.3l53.55,40.8c0,7.65-2.55,15.3-2.55,25.5s0,17.85,2.55,25.5l-53.55,43.35    c-5.1,5.101-5.1,10.2-2.55,15.301l51,89.25c2.55,2.55,7.649,5.1,15.3,2.55l63.75-25.5c12.75,10.2,28.05,17.85,43.35,25.5    l10.2,66.3c0,5.1,5.1,10.2,12.75,10.2h102c5.101,0,12.75-5.101,12.75-10.2l10.2-66.3c15.3-7.65,30.6-15.3,43.35-25.5l63.75,25.5    c5.101,2.55,12.75,0,15.301-5.101l51-89.25c2.55-5.1,2.55-12.75-2.551-15.3L440.813,280.5z M252.113,344.25    c-48.45,0-89.25-40.8-89.25-89.25s40.8-89.25,89.25-89.25s89.25,40.8,89.25,89.25S300.563,344.25,252.113,344.25z"></path>
	</g>
</g>
</svg></div>
    </div>
    <canvas id="largecanv" ></canvas>
    <canvas id="littlecanv" ></canvas>
</div>
                
</body>
<script>
 window.onload = function() {
 let canvcanv = document.getElementById('largecanv');
 var ctx = canvcanv.getContext('2d');
 littlecanv.width = 300;
 littlecanv.height = 300;
 let lcanv = document.getElementById('littlecanv');
 var gtx = lcanv.getContext('2d', { alpha: false });
 document.getElementById('littlecanv').remove();
 let pix = [];let bool = 0;
 for(let i = 0;i<300;i++){
     
     
     for(let z = 0;z<301;z++){
         let id = (i*300)+z;
         let color = "rgb("+randomInteger(0, 25)+","+randomInteger(0, 25)+","+randomInteger(0, 25)+")";
         //if(bool == 1){bool = 0; color = "red";}else{bool = 1; color = "blue"}
         
         
         //pix.push({id:id,color:color})
         gtx.fillStyle = color;
         gtx.fillRect(z,i,1,1);
     }
 }
 
 console.log(pix)
 canvcanv.width=window.outerWidth;
 canvcanv.height=window.outerHeight;
 (function() {
       
        context = canvcanv.getContext('2d');
        canvcanv.width = window.innerWidth;
        canvcanv.height = window.innerHeight;
 })();
function placePix(e){
    console.log(e)
  let pixLenght = gSize/300
  let Xx=Math.floor((e.clientX-gameX)/pixLenght)
  let Yy=Math.floor((e.clientY-gameY)/pixLenght)
  let  ID = Yy*300+Xx;
  console.log(ID)
  gtx.fillStyle = "rgb("+randomInteger(250, 254)+","+randomInteger(0, 20)+","+randomInteger(0, 20)+")";;
  gtx.fillRect(Xx,Yy,1,1);
  draw(gSize)
}
function draw(size,X){
    if(!X){X = 1;}
    ctx.clearRect(0, 0, canvcanv.width, canvcanv.height);
    ctx.mozImageSmoothingEnabled = false;ctx.webkitImageSmoothingEnabled = false;ctx.msImageSmoothingEnabled = false;ctx.imageSmoothingEnabled = false;gtx.mozImageSmoothingEnabled = false;gtx.webkitImageSmoothingEnabled = false;gtx.msImageSmoothingEnabled = false;gtx.imageSmoothingEnabled = false;
 
    ctx.drawImage(lcanv, gameX*X, gameY*X, size, size);
    //ctx.fillRect(gameX,gameY,size,size);
}
function randomInteger(min, max) {

  let rand = min + Math.random() * (max + 1 - min);
  return Math.floor(rand);
}

// "add" rectangle onto canvas

let gSize = 500,gameX=window.innerWidth/2,gameY=window.innerHeight/2,lastX=0,lastY=0;
let canvasDr = false,candraw = true;
draw(gSize)
canvcanv.addEventListener('mousedown', function (event) {
    canvasDr = true;

}, false);
canvcanv.addEventListener('mousemove', function (event) {
    if(canvasDr){
       candraw = false;
       gameX += event.clientX - lastX
       gameY += event.clientY - lastY
       
       draw(gSize)
    }
    lastX = event.clientX
    lastY = event.clientY

}, false);
canvcanv.addEventListener('mouseup', function (e) {
    if (candraw){placePix(e)}
    canvasDr = false;
    candraw = true;
}, false);

function addOnWheel(elem, handler) {if (elem.addEventListener) {if ('onwheel' in document) {elem.addEventListener("wheel", handler);} else if ('onmousewheel' in document) {elem.addEventListener("mousewheel", handler);} else {elem.addEventListener("MozMousePixelScroll", handler);}}else{text.attachEvent("onmousewheel", handler);}}
let zoomP = 70;
addOnWheel(canvcanv, function(e) {
    
    if(e.deltaY<0 && zoomP<1315){//zoom
        zoomP = zoomP + 70;
        let xxx = Math.trunc(((gameX-lastX)*-1)/(gSize/zoomP)*1000)/1000
        let yyy = Math.trunc(((gameY-lastY)*-1)/(gSize/zoomP)*1000)/1000
        gSize = gSize+zoomP;
        gameX = gameX-xxx;
        gameY = gameY-yyy;
        draw(gSize)
        
        
    }else
    if( e.deltaY>0 && gSize > 505){ //back
           
        
        let xxx = Math.trunc(((gameX-lastX)*-1)/(gSize/zoomP)*1000)/1000
        let yyy = Math.trunc(((gameY-lastY)*-1)/(gSize/zoomP)*1000)/1000
        gSize = gSize-zoomP;
        gameX = gameX+xxx;
        gameY = gameY+yyy;
        draw(gSize)
        if(zoomP<140){}else{ zoomP = zoomP - 70;}  
    }
    
    e.preventDefault();
});   
///////////////////////////////////////////////////phone
let log = document.getElementById('log')
let lastRazn = 0;
        canvcanv.addEventListener("touchstart", function (event) {
            canvasDr = true;
            lastX = event.touches[0].clientX
            lastY = event.touches[0].clientY
            event.preventDefault();
            lastRazn = 0;
            //
            console.log(event)
            //
           
        }, false); 

        canvcanv.addEventListener("touchmove", function (event) {
            let allTouches = event.touches.length;
            if(canvasDr && allTouches == 1){
                candraw = false;
                gameX += event.touches[0].clientX - lastX
                gameY += event.touches[0].clientY - lastY
                console.log("X: "+gameX+" Y: "+gameY)
                draw(gSize)
            } else 
            if (allTouches == 2){
                candraw = false;

                phoneZoom(event.touches[0],event.touches[1])
            }
            
            lastX = event.touches[0].clientX
            lastY = event.touches[0].clientY
            
            event.preventDefault();
        }, false,{passive: false});
        canvcanv.addEventListener("touchend", function (event) {
            canvasDr = false;
            if (candraw){placePix(event.changedTouches[0])}
            if (event.touches.length == 0){candraw = true;}
            console.log(event)
            
            event.preventDefault();
        }, false);

        let phoneZoomFix = 1;
        function phoneZoom(one,two){
            zoomP = 7;
            var dist = Math.hypot(
                one.pageX - two.pageX,
                one.pageY - two.pageY);
            let x1, x2;
            if(one.pageX > two.pageX){
                 x1 =  two.pageX;
                 x2 =  one.pageX;
            }else{
                 x1 =  one.pageX;
                 x2 =  two.pageX;
            }
           
            let y1, y2;
            if(one.pageY > two.pageY){
                 y1 =  two.pageY;
                 y2 =  one.pageY;
            }else{
                 y1 =  one.pageY;
                 y2 =  two.pageY;
            }
            
            let touchCenterX = ((x2-x1)/2)+x1
            let touchCenterY = ((y2-y1)/2)+y1

          
            
           
            if(lastRazn == 0){
                lastRazn = dist;
            }else{
                let raznrazn = lastRazn - dist;
                let strPress = Math.trunc(raznrazn*100)/100
                if(strPress<0){strPress=strPress*-1};

                
                
                
                
                    if(raznrazn<0&& gSize<10000&&strPress>0.1){
                        //if(phoneZoomFix < 10){phoneZoomFix=phoneZoomFix+1;}
                        zoomP = zoomP + 7*strPress;
                        let xxx = Math.trunc((((gameX-touchCenterX)*-1)/(gSize/(zoomP)))*100)/100
                        let yyy = Math.trunc((((gameY-touchCenterY)*-1)/(gSize/(zoomP)))*100)/100         //zoom
                        gSize = gSize+(zoomP);
                        gameX = gameX-xxx;
                        gameY = gameY-yyy;
                        draw(gSize)
                        
                    }else
                    if(raznrazn>1&&gSize>250&&strPress>0.1){  
                        if(zoomP>1){zoomP = zoomP + 7*strPress;}
                        let xxx = Math.trunc((((gameX-touchCenterX)*-1)/(gSize/(zoomP)))*100)/100
                        let yyy = Math.trunc((((gameY-touchCenterY)*-1)/(gSize/(zoomP)))*100)/100           //back
                        gSize = gSize-(zoomP);
                        gameX = gameX+xxx;
                        gameY = gameY+yyy;
                        draw(gSize)
                        //if(phoneZoomFix > 1){phoneZoomFix=phoneZoomFix-0.1;}
                        
                    }
                



                lastRazn = dist;
            }
        }


    }
//////////////////////////////////////////////////////


// document.getElementsByClassName('canvas-container')[0].style.top= "-8px";
// document.getElementsByClassName('canvas-container')[0].style.left= "-8px";
</script>
</html
