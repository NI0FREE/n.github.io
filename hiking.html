<!DOCTYPE html>
<html lang="en">
    <head>
        <style text="text/css">
            * { margin:0; padding:0; }
            html, body { width:100%; height:100%; }
            canvas { display:block; }
        </style>
    </head>
<body>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>

    <script>
        let myinfo = 0;
     vkBridge.send('VKWebAppInit');
    vkBridge.send("VKWebAppGetUserInfo").then(result => {
        myinfo = result;})
    </script> 
    <script src="file:///C:/Users/vasin/Desktop/helloworld/fabric.min%20(1).js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<div class="intro">
    <p id="log" style="position: absolute;">no logs</p>
    <canvas id="largecanv" ></canvas>
    <canvas id="littlecanv" ></canvas>
</div>
                
</body>
<script>
 window.onload = function() {
 let canvcanv = document.getElementById('largecanv');
 var ctx = canvcanv.getContext('2d');
 littlecanv.width = 300;
 littlecanv.height = 300;
 let lcanv = document.getElementById('littlecanv');
 var gtx = lcanv.getContext('2d', { alpha: false });
 document.getElementById('littlecanv').remove();
 let pix = [];let bool = 0;
 for(let i = 0;i<300;i++){
     
     
     for(let z = 0;z<301;z++){
         let id = (i*300)+z;
         let color = "rgb("+randomInteger(0, 25)+","+randomInteger(0, 25)+","+randomInteger(0, 25)+")";
         //if(bool == 1){bool = 0; color = "red";}else{bool = 1; color = "blue"}
         
         
         //pix.push({id:id,color:color})
         gtx.fillStyle = color;
         gtx.fillRect(z,i,1,1);
     }
 }
 
 console.log(pix)
 canvcanv.width=window.outerWidth;
 canvcanv.height=window.outerHeight;
 (function() {
       
        context = canvcanv.getContext('2d');
        canvcanv.width = window.innerWidth;
        canvcanv.height = window.innerHeight;
 })();
function placePix(e){
    console.log(e)
  let pixLenght = gSize/300
  let Xx=Math.floor((e.clientX-gameX)/pixLenght)
  let Yy=Math.floor((e.clientY-gameY)/pixLenght)
  let  ID = Yy*300+Xx;
  console.log(ID)
  gtx.fillStyle = "rgb("+randomInteger(195, 254)+","+randomInteger(195, 254)+","+randomInteger(195, 254)+")";;
  gtx.fillRect(Xx,Yy,1,1);
  draw(gSize)
}
function draw(size,X){
    if(!X){X = 1;}
    ctx.clearRect(0, 0, canvcanv.width, canvcanv.height);
    ctx.mozImageSmoothingEnabled = false;ctx.webkitImageSmoothingEnabled = false;ctx.msImageSmoothingEnabled = false;ctx.imageSmoothingEnabled = false;gtx.mozImageSmoothingEnabled = false;gtx.webkitImageSmoothingEnabled = false;gtx.msImageSmoothingEnabled = false;gtx.imageSmoothingEnabled = false;
 
    ctx.drawImage(lcanv, gameX*X, gameY*X, size, size);
    //ctx.fillRect(gameX,gameY,size,size);
}
function randomInteger(min, max) {

  let rand = min + Math.random() * (max + 1 - min);
  return Math.floor(rand);
}

// "add" rectangle onto canvas

let gSize = 1000,gameX=window.innerWidth/2,gameY=window.innerHeight/2,lastX=0,lastY=0;
let canvasDr = false,candraw = true;
draw(gSize)
canvcanv.addEventListener('mousedown', function (event) {
    canvasDr = true;

}, false);
canvcanv.addEventListener('mousemove', function (event) {
    if(canvasDr){
       candraw = false;
       gameX += event.clientX - lastX
       gameY += event.clientY - lastY
       
       draw(gSize)
    }
    lastX = event.clientX
    lastY = event.clientY

}, false);
canvcanv.addEventListener('mouseup', function (e) {
    if (candraw){placePix(e)}
    canvasDr = false;
    candraw = true;
}, false);

function addOnWheel(elem, handler) {if (elem.addEventListener) {if ('onwheel' in document) {elem.addEventListener("wheel", handler);} else if ('onmousewheel' in document) {elem.addEventListener("mousewheel", handler);} else {elem.addEventListener("MozMousePixelScroll", handler);}}else{text.attachEvent("onmousewheel", handler);}}
let zoomP = 70;
addOnWheel(canvcanv, function(e) {
    
    if(e.deltaY<0 && zoomP<1315){//zoom
        zoomP = zoomP + 70;
        let xxx = Math.trunc(((gameX-lastX)*-1)/(gSize/zoomP)*1000)/1000
        let yyy = Math.trunc(((gameY-lastY)*-1)/(gSize/zoomP)*1000)/1000
        gSize = gSize+zoomP;
        gameX = gameX-xxx;
        gameY = gameY-yyy;
        draw(gSize)
        
        
    }else
    if( e.deltaY>0 && gSize > 505){ //back
           
        
        let xxx = Math.trunc(((gameX-lastX)*-1)/(gSize/zoomP)*1000)/1000
        let yyy = Math.trunc(((gameY-lastY)*-1)/(gSize/zoomP)*1000)/1000
        gSize = gSize-zoomP;
        gameX = gameX+xxx;
        gameY = gameY+yyy;
        draw(gSize)
        if(zoomP<140){}else{ zoomP = zoomP - 70;}  
    }
    
    e.preventDefault();
});   
///////////////////////////////////////////////////phone
let log = document.getElementById('log')
let lastRazn = 0;
        canvcanv.addEventListener("touchstart", function (event) {
            canvasDr = true;
            lastX = event.touches[0].clientX
            lastY = event.touches[0].clientY
            event.preventDefault();
            lastRazn = 0;
            
        }, false); 

        canvcanv.addEventListener("touchmove", function (event) {
            let allTouches = event.touches.length;
            if(canvasDr && allTouches == 1){
                candraw = false;
                gameX += event.touches[0].clientX - lastX
                gameY += event.touches[0].clientY - lastY
                console.log("X: "+gameX+" Y: "+gameY)
                draw(gSize)
            } else 
            if (allTouches == 2){
                

                phoneZoom(event.touches[0],event.touches[1])
            }
            
            lastX = event.touches[0].clientX
            lastY = event.touches[0].clientY

            event.preventDefault();
        }, false,{passive: false});
        canvcanv.addEventListener("touchend", function (event) {
            canvasDr = false;
            if (candraw){placePix(event.changedTouches[0])}
            candraw = true;
            event.preventDefault();
        }, false);

        zoomP = 1;
        function phoneZoom(one,two){
           
            var dist = Math.hypot(
                one.pageX - two.pageX,
                one.pageY - two.pageY);
            let x1, x2;
            if(one.pageX > two.pageX){
                 x1 =  two.pageX;
                 x2 =  one.pageX;
            }else{
                 x1 =  one.pageX;
                 x2 =  two.pageX;
            }
           
            let y1, y2;
            if(one.pageY > two.pageY){
                 y1 =  two.pageY;
                 y2 =  one.pageY;
            }else{
                 y1 =  one.pageY;
                 y2 =  two.pageY;
            }
            
            let touchCenterX = ((x2-x1)/2)+x1
            let touchCenterY = ((y2-y1)/2)+y1

          
            
           
            if(lastRazn == 0){
                lastRazn = dist;
            }else{
                let raznrazn = lastRazn - dist;
                let strPress = Math.trunc(raznrazn*100)/100
                if(strPress<0){strPress=strPress*-1};

                
               
                log.innerHTML = strPress;
                if(raznrazn<0&& zoomP<515&&strPress>0.2){
                    //zoomP = zoomP + 5;
                    let xxx = Math.trunc(((gameX-touchCenterX)*-1)/(gSize/zoomP*strPress))
                    let yyy = Math.trunc(((gameY-touchCenterY)*-1)/(gSize/zoomP*strPress))         //zoom
                    gSize = gSize+zoomP*strPress;
                    gameX = gameX-xxx;
                    gameY = gameY-yyy;
                    draw(gSize)
                    
                }else
                if(raznrazn>1&&gSize>250&&strPress>0.2){  
                    let xxx = Math.trunc(((gameX-touchCenterX)*-1)/(gSize/zoomP*strPress))
                    let yyy = Math.trunc(((gameY-touchCenterY)*-1)/(gSize/zoomP*strPress))       //back
                    gSize = gSize-zoomP*strPress;
                    gameX = gameX+xxx;
                    gameY = gameY+yyy;
                    draw(gSize)
                    //if(zoomP>15){zoomP = zoomP - 5 ;}
                    
                }
    



                lastRazn = dist;
            }
        }


    }
//////////////////////////////////////////////////////


// document.getElementsByClassName('canvas-container')[0].style.top= "-8px";
// document.getElementsByClassName('canvas-container')[0].style.left= "-8px";
</script>
</html
